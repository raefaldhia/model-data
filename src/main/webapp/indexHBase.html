<!DOCTYPE html>
<html>
    <head>
        <title>tugas-besar</title>
    </head>
    <body>
        <div>
 	    <h3>insert</h3>
            <label for="author">Author:</label><br>
	    <input type="text" id="author" name="author"><br>
            <label for="name">Name:</label><br>
            <input type="text" id="name" name="name"><br>
            <label for="year">Year:</label><br>
            <input type="number" id="year" name="year"><br>
            <label for="words">Words:</label><br>
            <input type="text" id="words" name="words"><br>
            <button type="button" onclick="insertDocument()">Add</button>
        </div>
        <div>
            <h3>search</h3>
            <label for="search-author">Author:</label><br>
	    <input type="text" id="search-author" name="search-author"><br>
            <label for="search-name">Name:</label><br>
            <input type="text" id="search-name" name="search-name"><br>
            <label for="search-year">Year:</label><br>
            <input type="number" id="search-year" name="search-year"><br>
            <label for="search-words">Words:</label><br>
            <input type="text" id="search-words" name="search-words"><br>
            <button type="button" onclick="getDocuments()">Search</button>
            <table id="search-result">
                <thead>
                    <tr>
                        <th>Author</th>
                        <th>Name</th>
                        <th>Year</th>
                        <th>Words</th>
                   </tr>    
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            function insertDocument() {
                axios.post('http://localhost:8080/site/documents-hbase/',
                           {'author': document.getElementById('author').value,
                            'name'  : document.getElementById('name').value,
                            'year'  : document.getElementById('year').value,
                            'words' : JSON.parse(document.getElementById('words').value)},
                           {headers: {'Content-Type': 'application/json'}})
                     .then(function (response) {
                         console.log(response)
                     })
                     .catch(function (error) {
                         console.error(error)
                     })
            }
            function getDocuments() {
                let
                query = {}
                if (document.getElementById('search-author').value.length != 0) {
                    query['author'] = document.getElementById('search-author').value
                }
                if (document.getElementById('search-name').value.length != 0) {
                    query['name'] = document.getElementById('search-name').value
                }
                if (document.getElementById('search-year').value.length != 0) {
                    query['year'] = Number(document.getElementById('search-year').value)
                }
                if (document.getElementById('search-words').value.length != 0) {
                    query['words'] = document.getElementById('search-words').value
                }
                axios.get('http://localhost:8080/site/documents-hbase/',
                          { params: query
                          })
                     .then(function (response) {
                         const 
                         table = document.createElement('tbody')
                         response.data.forEach(document => {
                             const
                             row = table.insertRow()
                             let
                             cell = null
                             cell = row.insertCell()
                             cell.innerHTML = document['author']
                             cell = row.insertCell()
                             cell.innerHTML = document['name']
                             cell = row.insertCell()
                             cell.innerHTML = document['year']                      
                             cell = row.insertCell()
                             cell.innerHTML = JSON.stringify(document['words'])
                         });
                         const
                         oldTable = document.getElementById("search-result").getElementsByTagName('tbody')[0]
                         oldTable.parentNode.replaceChild(table, oldTable)

                     })
                     .catch(function (error) {
                         console.error(error)
                     })
            }
        </script>
    </body>
</html>
